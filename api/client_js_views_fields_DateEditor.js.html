<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client/js/views/fields/DateEditor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client/js/views/fields/DateEditor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const FieldEditor = require('./FieldEditor');

/**
 * An editor for date values
 */
class DateEditor extends FieldEditor {
    constructor(params) {
        super(params);

        // Ensure correct type
        if(typeof params.value === 'string' &amp;&amp; !isNaN(params.value)) {
            this.value = new Date(parseInt(params.value));

        } else if(params.value) {
            this.value = new Date(params.value);
        
        }

        // Sanity check
        if(!this.value || !params.value || this.value.getFullYear() == 1970 || isNaN(this.value.getTime())) {
            this.value = null;

            this.onChange();
        }

        this.init();
    }

    /**
     * Event: Change value
     */
    onChange() {
        this.trigger('change', this.value);
    }

    /**
     * Event: On click remove
     */
    onClickRemove() {
        this.value = null;

        this.$element.find('.btn-edit').html(this.formatDate(this.value));

        this.onChange();
    }

    /**
     * Event: Click open
     */
    onClickOpen() {
        let date = this.value ? new Date(this.value) : new Date();

        if(isNaN(date.getDate())) {
            date = new Date();
        }

        // Make sure minutes are rounded to nearest multiple of 5
        date.setMinutes(Math.floor(date.getMinutes()/5)*5);
        
        let days = [
            'Mon',
            'Tue',
            'Wed',
            'Thu',
            'Fri',
            'Sat',
            'Sun'
        ];

        let months = [
            'Jan',
            'Feb',
            'Mar',
            'Apr',
            'May',
            'Jun',
            'Jul',
            'Aug',
            'Sep',
            'Oct',
            'Nov',
            'Dec'
        ];

        let hours = [ '00', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23' ];
        let minutes = [ '00', '05', '10', '15', '20', '25', '30', '35', '40', '45', '50', '55' ];

        let messageModal = new MessageModal({
            model: {
                class: 'date-picker'   
            },
            renderTitle: () => {
                return [
                    _.span(date.getFullYear().toString()),
                    _.h2({class: 'date-picker-title'}, days[date.getDay()] + ', ' + months[date.getMonth()] + ' ' + date.getDate())
                ]
            },
            renderBody: () => {
                return [
                    _.div({class: 'date-picker-top-nav'},
                        _.button({class: 'btn btn-embedded'},
                            _.span({class: 'fa fa-angle-left'})
                        ).click(() => {
                            date.setMonth(date.getMonth() - 1);

                            messageModal.reload();
                        }),
                        _.span(months[date.getMonth()] + ' ' + date.getFullYear()),
                        _.button({class: 'btn btn-embedded'},
                            _.span({class: 'fa fa-angle-right'})
                        ).click(() => {
                            date.setMonth(date.getMonth() + 1);
                            
                            messageModal.reload();
                        })
                    ),
                    _.div({class: 'date-picker-weekdays'},
                        _.span('M'),
                        _.span('T'),
                        _.span('W'),
                        _.span('T'),
                        _.span('F'),
                        _.span('S'),
                        _.span('S')
                    ),
                    _.div({class: 'date-picker-days'},
                        _.each(this.getDays(date.getFullYear(), date.getMonth() + 1), (i, day) => {
                            let thisDate = new Date(date.getTime());
                            let now = new Date();

                            let isCurrent =
                                now.getFullYear() == date.getFullYear() &amp;&amp;
                                now.getMonth() == date.getMonth() &amp;&amp;
                                now.getDate() == day;
                            
                            let isActive = date.getDate() == day;

                            thisDate.setDate(day);

                            let $button = _.button({class: 'btn btn-embedded' + (isCurrent ? ' current' : '') + (isActive ? ' active' : '')}, day)
                                .click(() => {
                                    date.setDate(day);
                                    
                                    $button.siblings().removeClass('active');  
                                    $button.addClass('active');

                                    messageModal.$element.find('.date-picker-title').html(days[date.getDay()] + ', ' + months[date.getMonth()] + ' ' + date.getDate());
                                });

                            return $button;
                        })
                    ),
                    _.div({class: 'date-picker-time'},
                        UI.inputDropdown(date.getHours() &lt; 10 ? '0' + date.getHours() : date.getHours().toString(), hours, (hour) => {
                            date.setHours(parseInt(hour));
                        }),
                        _.div({class: 'date-picker-time-separator'}, ':'),
                        UI.inputDropdown(date.getMinutes() &lt; 10 ? '0' + date.getMinutes() : date.getMinutes().toString(), minutes, (minute) => {
                            date.setMinutes(parseInt(minute));
                        })
                    )
                ];
            },
            buttons: [
                {
                    label: 'Cancel',
                    class: 'btn-default'
                },
                {
                    label: 'OK',
                    class: 'btn-primary',
                    callback: () => {
                        this.value = date;

                        this.$element.find('.btn-edit').html(this.formatDate(date));

                        this.onChange();
                    }
                }
            ]
        });
    }

    /**
     * Renders day buttons
     *
     * @param {Number} year
     * @param {Number} month
     *
     * @returns {Array} Days
     */
    getDays(year, month) {
        let max = new Date(year, month, 0).getDate();
        let days = [];

        while(days.length &lt; max) {
            days[days.length] = days.length + 1;
        }

        return days;
    }

    /**
     * Format a date string
     *
     * @param {String} input
     *
     * @returns {String} Formatted date string
     */
    formatDate(input) {
        let output = '(none)';
        let date = new Date(input);

        if(input &amp;&amp; !isNaN(date.getTime())) {
            let day = date.getDate();
            let month = date.getMonth() + 1;
            let hours = date.getHours();
            let minutes = date.getMinutes();

            if(day &lt; 10) {
                day = '0' + day;
            }

            if(month &lt; 10) {
                month = '0' + month;
            }
            
            if(hours &lt; 10) {
                hours = '0' + hours;
            }
            
            if(minutes &lt; 10) {
                minutes = '0' + minutes;
            }

            output = date.getFullYear() + '.' + month + '.' + day + ' - ' + hours + ':' + minutes;
        } 

        return output;
    }

    render() {
        this.$element = _.div({class: 'field-editor date-editor input-group'},
            // Render preview
            this.renderPreview(),

            _.if(this.disabled,
                _.p({}, this.formatDate(this.value))
            ),
            _.if(!this.disabled,
                _.button({class: 'form-control btn btn-edit'}, 
                    this.formatDate(this.value)
                ).click(() => { this.onClickOpen(); }),
                _.div({class: 'input-group-btn'},
                    _.button({class: 'btn btn-small btn-default'}, 
                        _.span({class: 'fa fa-remove'})
                    ).click(() => { this.onClickRemove(); })
                )
            )
        );
    }
}

module.exports = DateEditor;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ApiController.html">ApiController</a></li><li><a href="AppHelper.html">AppHelper</a></li><li><a href="BackupHelper.html">BackupHelper</a></li><li><a href="BooleanEditor.html">BooleanEditor</a></li><li><a href="Connection.html">Connection</a></li><li><a href="ConnectionController.html">ConnectionController</a></li><li><a href="Content.html">Content</a></li><li><a href="ContentController.html">ContentController</a></li><li><a href="ContentReferenceEditor.html">ContentReferenceEditor</a></li><li><a href="ContentSchema.html">ContentSchema</a></li><li><a href="ContentSchemaReferenceEditor.html">ContentSchemaReferenceEditor</a></li><li><a href="Controller.html">Controller</a></li><li><a href="DateEditor.html">DateEditor</a></li><li><a href="DropdownEditor.html">DropdownEditor</a></li><li><a href="Entity.html">Entity</a></li><li><a href="FieldSchema.html">FieldSchema</a></li><li><a href="Form.html">Form</a></li><li><a href="FormEditor.html">FormEditor</a></li><li><a href="FormHelper.html">FormHelper</a></li><li><a href="InfoEditor.html">InfoEditor</a></li><li><a href="JSONEditor.html">JSONEditor</a></li><li><a href="LanguageEditor.html">LanguageEditor</a></li><li><a href="Media.html">Media</a></li><li><a href="MediaReferenceEditor.html">MediaReferenceEditor</a></li><li><a href="MessageModal.html">MessageModal</a></li><li><a href="MongoHelper.html">MongoHelper</a></li><li><a href="NavbarMain.html">NavbarMain</a></li><li><a href="NumberEditor.html">NumberEditor</a></li><li><a href="ProjectEditor.html">ProjectEditor</a></li><li><a href="ProjectHelper.html">ProjectHelper</a></li><li><a href="ProvidersSettings.html">ProvidersSettings</a></li><li><a href="RequestHelper.html">RequestHelper</a></li><li><a href="ResourceReferenceEditor.html">ResourceReferenceEditor</a></li><li><a href="RichTextEditor.html">RichTextEditor</a></li><li><a href="ScheduleController.html">ScheduleController</a></li><li><a href="ScheduleHelper.html">ScheduleHelper</a></li><li><a href="Schema.html">Schema</a></li><li><a href="SchemaController.html">SchemaController</a></li><li><a href="SchemaEditor.html">SchemaEditor</a></li><li><a href="SchemaHelper.html">SchemaHelper</a></li><li><a href="StringEditor.html">StringEditor</a></li><li><a href="StructEditor.html">StructEditor</a></li><li><a href="SyncEditor.html">SyncEditor</a></li><li><a href="SyncHelper.html">SyncHelper</a></li><li><a href="TagsEditor.html">TagsEditor</a></li><li><a href="Task.html">Task</a></li><li><a href="Template.html">Template</a></li><li><a href="TemplateEditor.html">TemplateEditor</a></li><li><a href="TemplateReferenceEditor.html">TemplateReferenceEditor</a></li><li><a href="UpdateHelper.html">UpdateHelper</a></li><li><a href="UrlEditor.html">UrlEditor</a></li><li><a href="UserHelper.html">UserHelper</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon May 29 2017 21:20:48 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
